---
title: 'C#中string.Format()输出内容中含有花括号的解决方法'
tags:
  - Json
  - C#
categories:
  - 编程
  - 算法
date: 2019-04-03 15:40:47
abbrlink:
comments:
---
今天测试需要写了如下一段代码，用string.Format填出一个简单的Json字符串，可是运行就会报错。
<!-- more -->
## 代码如下
```
string s = string.Format("{\"id\"=\"{0}\"}, \"name\"=\"{1}\"}", id, name);
```
## 分析
我希望的结果是得到字符串 {"id"=id, "name"=name}，经过检查后确定问题出在文本内容中包含了“{”和“}”，因为花括号字符是拿来做填充检测的（比如{0}表示首个子串），函数并不知道我们最外面的花括号是文本内容，结果就解析失败了。

知道了原因，那么解决办法自然就来了：
## 方案一
```
string s = "{" + string.Format("\"id\"=\"{0}\"}, \"name\"=\"{1}\"", id, name) + "}"; 
```
但是这个办法治标不治本，如果这个Json结构很复杂有花括号嵌套，我们处理就麻烦了，那么就把花括号当作子串内容传进来处理，所以得到了下面的改进办法：
## 方案二
```
string s = string.Format("{0}\"id\"=\"{2}\"}, \"name\"=\"{3}\"{1}", "{", "}", id, name); 
```
只要是要填“｛”和“｝”的地方，用{0}和{1}替换就行了。可是这种办法稍微有点绕，总有点不舒服。
再细想一下微软在提供string.Format方法时，不会没有考虑到花括号问题，就像文本内双引号内容我们用 \" 表示，查了一下果然有代替表示方法，用两个连在一起的“{{”表示“{”，右花括号也同理，所以得到最终解决方案：
## 终极解决方案
```
string s = string.Format("{{\"id\"=\"{2}\"}, \"name\"=\"{3}\"}}", id, name); 
```